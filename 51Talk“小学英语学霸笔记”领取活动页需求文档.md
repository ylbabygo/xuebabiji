### **51Talk“小学英语学霸笔记”领取活动页需求文档 (PRD)**

**1. 项目概述**

**1.1. 项目背景**
为提升51Talk品牌在小学英语教育领域的影响力，并为潜在用户提供高价值的学习资料，特策划本次“小学英语学霸笔记”免费领取活动。通过此活动页面，我们旨在吸引目标用户（小学生家长），分发不同版本的学习资料，并以此作为市场拉新和品牌推广的重要触点。

**1.2. 项目目标**
*   **核心目标:** 吸引家长用户，并成功分发至少 [可设定一个KPI，如: 10,000份] 学习资料。
*   **用户目标:** 为用户提供一个简单、快捷的通道，免费获取与其孩子教材版本匹配的优质学习笔记。
*   **技术目标:** 实现一个轻量级的、无需用户登录的领取限制机制，确保在一定程度上防止资料被大规模重复恶意刷取。

**1.3. 目标用户**
*   **主要用户:** 中国大陆地区小学一至六年级学生的家长。
*   **用户特征:** 关心孩子英语学习，活跃于各类教育社群，对免费、优质的学习资源有较高兴趣。

---

**2. 页面与功能需求**

**2.1. 页面整体设计与布局 (UI/UX)**

*   **品牌风格:** 页面整体视觉风格需严格遵守51Talk的品牌规范（VI）。主色调采用51Talk标志性的黄色和蓝色，营造活泼、专业、可信赖的氛围。
*   **页面结构 (从上到下):**
    1.  **顶部Banner:** 突出活动主题“51Talk免费送！小学英语学霸笔记”，并使用吸引人的设计元素（如卡通形象、笔记实物图等）。
    2.  **价值说明区:** 简要介绍这套笔记的亮点（如：名师整理、覆盖核心考点、图文并茂等），增强用户领取意愿。
    3.  **版本选择区:** 这是页面的核心交互区域。以卡片或列表形式，清晰展示所有可选的笔记版本。
    4.  **领取按钮:** 一个醒目的、贯穿页面的主行动号召（Call-to-Action）按钮。
    5.  **底部版权区:** 包含51Talk的Logo和版权信息。
*   **移动端优先:** 页面设计必须优先考虑在手机等移动设备上的浏览体验，确保响应式布局能完美适配不同尺寸的屏幕。

**2.2. 功能详细说明**

| 模块 | 功能点 | 详细描述 | 优先级 |
| :--- | :--- | :--- | :--- |
| **资料展示** | FR1: 版本列表 | 页面需以清晰的卡片样式展示所有可选的笔记版本，每个卡片上应包含版本名称（例如：“人教版三起点”）。 | 高 |
| | FR2: 单选交互 | 用户通过点击卡片来选择版本。被选中的卡片应有明显高亮或边框效果，以示区分。**同一时间只能选择一个版本**。 | 高 |
| **核心交互** | FR3: “立即领取”按钮 | 页面上有一个固定的、非常醒目的“立即免费领取”按钮。当用户未选择任何版本时，该按钮为灰色不可点击状态；选择任一版本后，按钮变为高亮可点击状态。 | 高 |
| | FR4: 领取流程触发 | 用户点击“立即免费领取”按钮后，前端立即触发后端验证流程。在等待后端返回结果期间，按钮应显示“正在验证...”或类似加载状态，并变为不可点击，防止用户重复提交。 | 高 |
| **限制逻辑** | FR5: 设备限制 (前端) | 1.  **领取前检查:** 页面加载时，JS首先检查本地存储 (`localStorage`) 中是否存在30天内有效的领取记录。<br>2.  **若存在:** 直接向用户显示“您已在当前设备领取过资料，请30天后再试”的提示，并禁用版本选择和领取按钮。<br>3.  **领取后记录:** 领取成功后，JS立即将**领取的版本**和**一个30天后的过期时间戳**写入`localStorage`。 | 高 |
| | FR6: IP限制 (后端) | 1.  **后端验证:** 前端调用一个Supabase云函数。该函数获取用户请求的公网IP地址。<br>2.  **数据库查询:** 云函数查询`anonymous_claims`数据表，检查该IP地址在过去30天内是否有领取记录。<br>3.  **拦截或放行:** 若存在记录，函数返回错误信息；若不存在，则继续执行写入操作并返回成功。 | 高 |
| **结果反馈** | FR7: 成功弹窗 | 验证成功后，页面弹出一个设计精美的模态框（Modal）。<br>**弹窗内容:**<br> - 标题：“恭喜你，领取成功！”<br> - 资料链接：明文展示对应版本的百度网盘链接。<br> - 提取码：明文展示提取码 `talk`。<br> - 提示：“链接和提取码已自动复制，快去打开网盘吧！” (可选增强体验)<br> - 关闭按钮。 | 高 |
| | FR8: 失败提示 | 如果因为设备或IP限制导致领取失败，页面应通过非侵入式的提示（如Toast或Alert）明确告知用户原因。<br> - **设备限制提示:** "您已在本设备领取过资料，无需重复领取。"<br> - **IP限制提示:** "当前网络领取人数过多，请稍后再试或更换网络环境。" | 高 |

**2.3. 用户流程图**

```mermaid
graph TD
    A[用户进入活动页] --> B{检查设备本地记录(LocalStorage)};
    B --> |有30天内记录| C[页面提示"已领取", 按钮置灰];
    B --> |无记录| D[展示所有笔记版本供选择];
    D --> E[用户选择一个版本];
    E --> F[“立即领取”按钮激活];
    F --> G[用户点击领取];
    G --> H{按钮显示"验证中", 调用云函数(携带IP)};
    H --> I{云函数检查IP是否在30天内领取过};
    I --> |是| J[云函数返回失败];
    J --> K[页面提示"当前网络领取人数过多"];
    I --> |否| L[云函数在数据库记录IP和时间];
    L --> M[云函数返回成功];
    M --> N[前端弹出成功窗口, 显示网盘链接+提取码];
    N --> O[前端在LocalStorage写入30天领取记录];
    C --> P[结束];
    K --> P;
    O --> P;
```

---

**3. 页面内容 (Copywriting)**

*   **页面大标题:** `51Talk 福利大放送！小学英语学霸笔记【免费领取】`
*   **价值描述 (参考):** `由51Talk金牌教研团队倾力打造，紧贴课堂教材，覆盖全部核心知识点！让孩子告别死记硬背，轻松掌握高分技巧！`
*   **版本选择区标题:** `请根据孩子的教材，选择对应的版本`
*   **按钮文案:**
    *   默认/激活状态: `立即免费领取`
    *   加载状态: `正在验证...`
    *   不可用状态: `请先选择一个版本`
*   **成功弹窗标题:** `领取成功！快去保存吧！`
*   **成功弹窗内容:** `您领取的版本：{用户选择的版本名称}<br>链接：{对应的百度网盘链接}<br>提取码：talk`

---

**4. 资料版本与链接映射**

| 显示名称 | 对应的百度网盘链接 |
| :--- | :--- |
| 人教版·一起点 | `https://pan.baidu.com/s/1tCTnBVJR27pGb5lBnfNJCg?pwd=talk` |
| 人教版·三起点 | `https://pan.baidu.com/s/1VxtrXNOoqeI-jyNl3VYucw?pwd=talk` |
| 北师大版 | `https://pan.baidu.com/s/1ehElAltU7dL9OT4K3lU3vw?pwd=talk` |
| 冀教版·一起点 | `https://pan.baidu.com/s/1OeLc_dnwdaU0TCEyM6-Ffg?pwd=talk` |
| 冀教版·三起点 | `https://pan.baidu.com/s/154u1tF-YzzOXqMmWZHpDRg?pwd=talk` |
| 外研社·一起点 | `https://pan.baidu.com/s/1girOir1Mx_pNOeQbc4i-iQ?pwd=talk` |
| 外研社·三起点 | `https://pan.baidu.com/s/1ByBQ9O6tnX7bTwOifFq7Jg?pwd=talk` |
| 译林版 | `https://pan.baidu.com/s/1Vs2yD0438JUPvmMOK5F89w?pwd=talk` |
| 沪教版 | `https://pan.baidu.com/s/1H97VszvcHAaSTJlPLlGMbA?pwd=talk` |

---

**5. 技术实现要点 (给开发者的备忘)**

*   **前端:**
    *   使用 `localStorage` 进行设备标记。`key`可以是 `51talk_claim_info`，`value`可以是一个包含 `version` 和 `expiryTimestamp` 的JSON字符串。
    *   页面加载时必须优先检查此标记。
    *   按钮的加载与禁用状态需妥善处理，提升用户体验。
*   **后端 (Supabase Edge Function):**
    *   函数需要配置为可以被公开调用（无需JWT验证）。
    *   使用 `Deno.env.get('SUPABASE_SERVICE_ROLE_KEY')` 初始化一个有管理员权限的Supabase客户端，以便读写数据库。
    *   从请求头 `x-forwarded-for` 中安全地获取客户端IP。
    *   数据库操作逻辑需包含：查询IP是否存在于30天内的记录 -> 如果不存在，则写入（或更新）该IP的领取时间和版本。
*   **数据库 (Supabase Postgres):**
    *   **表名:** `anonymous_claims`
    *   **字段:**
        *   `ip_address` (text, **Unique**): 将IP地址设为唯一键，方便使用 `upsert`。
        *   `last_claimed_at` (timestamp with time zone): 记录领取时间。
        *   `claimed_version` (text): 记录领取的版本。